{"paragraphs":[{"text":"%pyspark\nfrom pyspark.sql import SparkSession\n\nspark = SparkSession \\\n    .builder \\\n    .appName(\"Text Summarization with Pyspark\") \\\n    .getOrCreate()\n\nsc = spark.sparkContext","user":"anonymous","dateUpdated":"2018-05-14T10:01:30+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689356_507511675","id":"20180502-085936_757276955","dateCreated":"2018-05-14T08:48:09+0000","dateStarted":"2018-05-14T10:01:30+0000","dateFinished":"2018-05-14T10:01:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3667","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nfrom pyspark.sql import Row\n\nall_wikipedia_files = sc.wholeTextFiles(\"s3://strata-demo-data/nlp_data/*(Clean Splits).txt\")\nwikipage_rdd_list = []\n#for i in range(30):\nfor i in range(1):\n    wikipage_rdd = all_wikipedia_files\\\n        .filter(lambda element: element[0].endswith('_' + str(i) + '(Clean Splits).txt'))\\\n        .values()\\\n        .flatMap(lambda text_string: text_string.split(\"---END.OF.DOCUMENT---\"))\\\n        .map(lambda text_string: text_string.strip(\"\\r\\n\").replace(\"\\r\\n\", \"\\n\"))\n  \n    wikipage_rdd.cache()\n    # Change from rdd of strings to rdd of rows\n    wikipage_rdd = wikipage_rdd.map(lambda element: Row(Body=element))\n    wikipage_rdd_list.append(wikipage_rdd)\n    \ncombined_wikipage_rdd = sc.union(wikipage_rdd_list)\n\n# Convert from rdd to dataframe\ncombined_wikipage_dataframe = spark.createDataFrame(combined_wikipage_rdd).repartition(256)\ncombined_wikipage_dataframe.head()\n#combined_wikipage_dataframe.write.format(\"csv\")\\\n#    .option(\"header\", \"true\")\\\n#    .mode(\"append\")\\\n#    .save(\"s3://strata-demo-data/nlp_data/Post_Processed_Wikipedia_Corpus.csv\")","user":"anonymous","dateUpdated":"2018-05-14T10:02:50+0000","config":{"lineNumbers":true,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689360_518284644","id":"20180503-143907_1984906638","dateCreated":"2018-05-14T08:48:09+0000","dateStarted":"2018-05-14T10:05:31+0000","dateFinished":"2018-05-14T10:08:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3668","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Row(Body=u'Montgomery, Indiana.\\nMontgomery is a town in Barr Township, Daviess County, Indiana, United States. The population was 368 at the 2000 census.\\nGeography.\\nMontgomery is located at (38.663427, -87.047099).\\nAccording to the United States Census Bureau, the town has a total area of 0.2\\xa0square miles (0.6\\xa0km\\xb2), all of it land.\\nDemographics.\\nAs of the census of 2000, there were 368 people, 140 households, and 100 families residing in the town. The population density was 1,527.7 people per square mile (592.0/km\\xb2). There were 153 housing units at an average density of 635.1/sq\\xa0mi (246.1/km\\xb2). The racial makeup of the town was 99.18% White, 0.27% African American, 0.27% Native American, and 0.27% from two or more races. Hispanic or Latino of any race were 0.82% of the population.\\nThere were 140 households out of which 35.0% had children under the age of 18 living with them, 57.9% were married couples living together, 10.7% had a female householder with no husband present, and 27.9% were non-families. 23.6% of all households were made up of individuals and 10.7% had someone living alone who was 65 years of age or older. The average household size was 2.61 and the average family size was 3.11.\\nIn the town the population was spread out with 25.8% under the age of 18, 10.1% from 18 to 24, 31.8% from 25 to 44, 19.6% from 45 to 64, and 12.8% who were 65 years of age or older. The median age was 34 years. For every 100 females there were 101.1 males. For every 100 females age 18 and over, there were 96.4 males.\\nThe median income for a household in the town was $36,944, and the median income for a family was $44,205. Males had a median income of $29,107 versus $17,206 for females. The per capita income for the town was $15,156. About 5.8% of families and 10.8% of the population were below the poverty line, including 13.6% of those under age 18 and 14.9% of those age 65 or over.\\nGasthof village.\\nThe town has a sizable Amish population who run a tourist attraction center called the Gasthof Amish Village. The village features various shops offering furniture, blankets, and other handmade goods created by the Amish. A large antique mall called the Blue Door is also ran by the village. Wagon rides and tours of the nearby Amish farms are offered to the public. Visitors can also stay at the Amish Inn and eat at the restaurant.')\n"}]}},{"text":"%pyspark\nimport re\nfrom pyspark.sql.functions import udf\n# Extract Wikipedia page title into new column\ndef extract_wikipage_title(wikipage_body):\n    matched_item = re.match(\"(.*)\\\\n\", wikipage_body)\n    return matched_item.group(1) if matched_item else \"N/A\"\n\n# Remove Wikipedia page title from item body\ndef remove_title_from_item_body(wikipage_body):\n    matched_item = re.match(\"(.*)\\\\n\", wikipage_body)\n    return wikipage_body[matched_item.end(1):].strip(\"\\n\") if matched_item else wikipage_body\n    \n    \nextract_wikipage_title_udf = udf(extract_wikipage_title)\nremove_title_from_item_body_udf = udf(remove_title_from_item_body)\n\ncombined_wikipage_dataframe = combined_wikipage_dataframe\\\n    .filter(combined_wikipage_dataframe.Body != \"\")\\\n    .withColumn(\"Title\", extract_wikipage_title_udf(combined_wikipage_dataframe.Body))\\\n    .select(\"Title\", \"Body\")\n\ncombined_wikipage_dataframe = combined_wikipage_dataframe\\\n    .withColumn(\"Body\", remove_title_from_item_body_udf(combined_wikipage_dataframe.Body))\n    \ncombined_wikipage_dataframe.cache()\ncombined_wikipage_dataframe.head()\n\n","user":"anonymous","dateUpdated":"2018-05-14T10:08:50+0000","config":{"lineNumbers":true,"editorSetting":{"language":"python","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689361_517899895","id":"20180504-101729_41722013","dateCreated":"2018-05-14T08:48:09+0000","dateStarted":"2018-05-14T10:08:50+0000","dateFinished":"2018-05-14T10:08:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3669","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Row(Title=u'Montgomery, Indiana.', Body=u'Montgomery is a town in Barr Township, Daviess County, Indiana, United States. The population was 368 at the 2000 census.\\nGeography.\\nMontgomery is located at (38.663427, -87.047099).\\nAccording to the United States Census Bureau, the town has a total area of 0.2\\xa0square miles (0.6\\xa0km\\xb2), all of it land.\\nDemographics.\\nAs of the census of 2000, there were 368 people, 140 households, and 100 families residing in the town. The population density was 1,527.7 people per square mile (592.0/km\\xb2). There were 153 housing units at an average density of 635.1/sq\\xa0mi (246.1/km\\xb2). The racial makeup of the town was 99.18% White, 0.27% African American, 0.27% Native American, and 0.27% from two or more races. Hispanic or Latino of any race were 0.82% of the population.\\nThere were 140 households out of which 35.0% had children under the age of 18 living with them, 57.9% were married couples living together, 10.7% had a female householder with no husband present, and 27.9% were non-families. 23.6% of all households were made up of individuals and 10.7% had someone living alone who was 65 years of age or older. The average household size was 2.61 and the average family size was 3.11.\\nIn the town the population was spread out with 25.8% under the age of 18, 10.1% from 18 to 24, 31.8% from 25 to 44, 19.6% from 45 to 64, and 12.8% who were 65 years of age or older. The median age was 34 years. For every 100 females there were 101.1 males. For every 100 females age 18 and over, there were 96.4 males.\\nThe median income for a household in the town was $36,944, and the median income for a family was $44,205. Males had a median income of $29,107 versus $17,206 for females. The per capita income for the town was $15,156. About 5.8% of families and 10.8% of the population were below the poverty line, including 13.6% of those under age 18 and 14.9% of those age 65 or over.\\nGasthof village.\\nThe town has a sizable Amish population who run a tourist attraction center called the Gasthof Amish Village. The village features various shops offering furniture, blankets, and other handmade goods created by the Amish. A large antique mall called the Blue Door is also ran by the village. Wagon rides and tours of the nearby Amish farms are offered to the public. Visitors can also stay at the Amish Inn and eat at the restaurant.')\n"}]}},{"text":"%pyspark\nfrom pyspark.sql.functions import udf\nfrom pyspark.sql.types import StringType\nfrom gensim.summarization.summarizer import summarize\n\n# Summarize \"Body\" column and assign to \"Summary\"\ndef summarize_body(body):\n    try:\n        text_summary = summarize(body)\n    except ValueError:\n        text_summary = body\n    return text_summary\n    \n# summarize_body_udf = udf(lambda body: summarize(body), StringType()) \nsummarize_body_udf = udf(summarize_body, StringType())\n\ncombined_wikipage_dataframe = combined_wikipage_dataframe\\\n    .withColumn(\"Summary\", summarize_body_udf(combined_wikipage_dataframe.Body))\n\ncombined_wikipage_dataframe.cache()\nexamples = combined_wikipage_dataframe.head(3)\nfor example in examples:\n    print(\"Title:\")\n    print(example.Title)\n    print(\"Body:\")\n    print(example.Body)\n    print(\"Summary:\")\n    print(example.Summary)","user":"anonymous","dateUpdated":"2018-05-14T10:27:39+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689361_517899895","id":"20180510-163519_551620764","dateCreated":"2018-05-14T08:48:09+0000","dateStarted":"2018-05-14T10:09:01+0000","dateFinished":"2018-05-14T10:09:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3670","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Title:\nMontgomery, Indiana.\nBody:\nMontgomery is a town in Barr Township, Daviess County, Indiana, United States. The population was 368 at the 2000 census.\nGeography.\nMontgomery is located at (38.663427, -87.047099).\nAccording to the United States Census Bureau, the town has a total area of 0.2 square miles (0.6 km²), all of it land.\nDemographics.\nAs of the census of 2000, there were 368 people, 140 households, and 100 families residing in the town. The population density was 1,527.7 people per square mile (592.0/km²). There were 153 housing units at an average density of 635.1/sq mi (246.1/km²). The racial makeup of the town was 99.18% White, 0.27% African American, 0.27% Native American, and 0.27% from two or more races. Hispanic or Latino of any race were 0.82% of the population.\nThere were 140 households out of which 35.0% had children under the age of 18 living with them, 57.9% were married couples living together, 10.7% had a female householder with no husband present, and 27.9% were non-families. 23.6% of all households were made up of individuals and 10.7% had someone living alone who was 65 years of age or older. The average household size was 2.61 and the average family size was 3.11.\nIn the town the population was spread out with 25.8% under the age of 18, 10.1% from 18 to 24, 31.8% from 25 to 44, 19.6% from 45 to 64, and 12.8% who were 65 years of age or older. The median age was 34 years. For every 100 females there were 101.1 males. For every 100 females age 18 and over, there were 96.4 males.\nThe median income for a household in the town was $36,944, and the median income for a family was $44,205. Males had a median income of $29,107 versus $17,206 for females. The per capita income for the town was $15,156. About 5.8% of families and 10.8% of the population were below the poverty line, including 13.6% of those under age 18 and 14.9% of those age 65 or over.\nGasthof village.\nThe town has a sizable Amish population who run a tourist attraction center called the Gasthof Amish Village. The village features various shops offering furniture, blankets, and other handmade goods created by the Amish. A large antique mall called the Blue Door is also ran by the village. Wagon rides and tours of the nearby Amish farms are offered to the public. Visitors can also stay at the Amish Inn and eat at the restaurant.\nSummary:\nAccording to the United States Census Bureau, the town has a total area of 0.2 square miles (0.6 km²), all of it land.\nAs of the census of 2000, there were 368 people, 140 households, and 100 families residing in the town.\nThe population density was 1,527.7 people per square mile (592.0/km²).\nIn the town the population was spread out with 25.8% under the age of 18, 10.1% from 18 to 24, 31.8% from 25 to 44, 19.6% from 45 to 64, and 12.8% who were 65 years of age or older.\nThe town has a sizable Amish population who run a tourist attraction center called the Gasthof Amish Village.\nTitle:\n1050s.\nBody:\nThe 1050s decade ran from January 1, 1050, to December 31, 1059.\nSummary:\nThe 1050s decade ran from January 1, 1050, to December 31, 1059.\nTitle:\nAlbertslund Municipality.\nBody:\nAlbertslund Kommune () is a municipality in Region Hovedstaden on the island of Zealand in eastern Denmark. The municipality covers an area of 23 km², and has a total population of 27,602 (2008). Its mayor is Steen Christiansen, a member of the Social Democrats (\"Socialdemokraterne\") political party. As of 2010 the social democrats have 9 of the 21 seats in the city council.\nThe main town and the site of its municipal council is the town of Albertslund.\nThe original name of the municipality was Herstedernes Kommune. In 1973 the name was changed to Albertslund Kommune. The name Herstederne represents the two communities of Herstedvester and Herstedøster which were the original villages in the area together with Vridsløse and Risby.\nNeighboring municipalities are Glostrup to the east, Ballerup and Egedal municipality to the north, Høje-Taastrup to the west, and Vallensbæk and Brøndby to the south.\nAlbertslund is home to Danmarks International Kollegium, which has won many awards for its design.\nAlbertslund is also known for its effort in raising awareness about climate change.\nAlbertslund Municipality was not merged with other municipalities by January 1, 2007 as the result of nationwide 2007 Municipal Reform.\nSummary:\nAlbertslund Kommune () is a municipality in Region Hovedstaden on the island of Zealand in eastern Denmark.\nThe original name of the municipality was Herstedernes Kommune.\n"}]}},{"text":"%pyspark\ncombined_wikipage_dataframe.write.parquet(\"s3://strata-demo-data/nlp_data/wikipage_summarization.parquet\")","user":"anonymous","dateUpdated":"2018-05-14T10:11:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526288212182_1228097103","id":"20180514-085652_510611115","dateCreated":"2018-05-14T08:56:52+0000","dateStarted":"2018-05-14T10:11:32+0000","dateFinished":"2018-05-14T10:24:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3671","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nimport spacy\nfrom pyspark.sql.functions import udf\n\nnlp = spacy.load(\"en\")\n\ndef generate_sentences(body, language_model):\n    print(type(body))\n    return [sent.string for sent in language_model(body).sents]\n\ndef generate_words(sentences, language_model):\n    list_of_words = []\n    for sentence in sentences:\n        list_of_words.append([token.text for token in language_model(sentence)])\n    return list_of_words\n\ngenerate_sentences_udf = udf(generate_sentences)\ngenerate_words_udf = udf(generate_words)\n\nprint(type(combined_wikipage_dataframe.Body))\n\ncombined_wikipage_dataframe = combined_wikipage_dataframe\\\n    .withColumn(\"Sentences\", generate_sentences_udf(combined_wikipage_dataframe.Body, nlp))\n    \n\ncombined_wikipage_dataframe = combined_wikipage_dataframe\\\n    .withColumn(\"Words\", generate_words_udf(combined_wikipage_dataframe.Sentences, nlp))\n\n\n","dateUpdated":"2018-05-14T08:48:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689362_519054142","id":"20180510-095705_1530625634","dateCreated":"2018-05-14T08:48:09+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3672"},{"text":"%pyspark\ncombined_wikipage_dataframe.head()","dateUpdated":"2018-05-14T08:48:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689362_519054142","id":"20180510-154747_722304029","dateCreated":"2018-05-14T08:48:09+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3673"},{"text":"%pyspark\n","dateUpdated":"2018-05-14T08:48:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1526287689362_519054142","id":"20180510-155559_1113369859","dateCreated":"2018-05-14T08:48:09+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3674"}],"name":"Load Text Data","id":"2DF536H8S","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}